{"version":3,"sources":["./src/app/pages/chat/chat.page.html","./src/app/pages/chat/chat-routing.module.ts","./src/app/pages/chat/chat.module.ts","./src/app/pages/chat/chat.page.scss","./src/app/pages/chat/chat.page.ts","./src/app/pages/chat/format-file-size.pipe.ts"],"names":[],"mappings":"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","file":"pages-chat-chat-module-es2015.js","sourcesContent":["export default \"<ion-header>\\r\\n  <ion-toolbar color=\\\"primary\\\">\\r\\n    <ion-title>Chat</ion-title>\\r\\n    <ion-buttons slot=\\\"end\\\">\\r\\n      <ion-button fill=\\\"clear\\\" (click)=\\\"logout()\\\">\\r\\n        <ion-icon name=\\\"log-out\\\" slot=\\\"icon-only\\\"></ion-icon>\\r\\n      </ion-button>\\r\\n    </ion-buttons>\\r\\n  </ion-toolbar>\\r\\n</ion-header>\\r\\n\\r\\n<ion-content class=\\\"ion-padding\\\">\\r\\n<ion-grid>\\r\\n  <ion-row *ngFor=\\\"let message of messages | async\\\">\\r\\n    <ion-col size=\\\"9\\\" class=\\\"message\\\" [offset]=\\\"message.myMsg ? 3 : 0\\\"\\r\\n    [ngClass]=\\\"{ 'my-message': message.myMsg, 'other-message': !message.myMsg }\\\">\\r\\n    \\r\\n\\r\\n    <b>{{ message.fromName }}</b><br>\\r\\n    <div *ngIf=\\\"trackSnapshot | async as snap\\\">\\r\\n      File size: {{ snap.totalBytes | formatFileSize }} \\r\\n      Data transfered: {{ snap.bytesTransferred | formatFileSize }}\\r\\n    </div> \\r\\n    <span>{{ message.msg }}\\r\\n    </span>\\r\\n    <div class=\\\"time ion-text-right\\\"><br>{{ message.createdAt?.toMillis() | date:'short' }}</div>\\r\\n\\r\\n    </ion-col>\\r\\n  </ion-row>\\r\\n</ion-grid>\\r\\n</ion-content>\\r\\n\\r\\n\\r\\n<ion-footer>\\r\\n  <ion-toolbar color=\\\"light\\\">\\r\\n    <ion-row class=\\\"ion-align-items-center\\\">\\r\\n      <ion-col size=\\\"8\\\">\\r\\n        <ion-textarea autoGrow=\\\"true\\\" class=\\\"message-input\\\" rows=\\\"1\\\" maxLength=\\\"400\\\" [(ngModel)]=\\\"newMsg\\\" >\\r\\n        </ion-textarea>\\r\\n      </ion-col>\\r\\n      <ion-col size=\\\"2\\\" *ngIf=\\\"!isUploading && !isUploaded\\\">\\r\\n        <ion-button expand=\\\"block\\\" fill=\\\"clear\\\" color=\\\"primary\\\" [disabled]=\\\"newMsg === ''\\\"\\r\\n          class=\\\"msg-btn\\\">\\r\\n          <input type=\\\"file\\\" (change)=\\\"uploadImage($event.target.files)\\\" />\\r\\n          <ion-icon name=\\\"attach-outline\\\" slot=\\\"icon-only\\\"></ion-icon>\\r\\n        </ion-button>\\r\\n      </ion-col>\\r\\n      <ion-col size=\\\"2\\\">\\r\\n        <ion-button expand=\\\"block\\\" fill=\\\"clear\\\" color=\\\"primary\\\" [disabled]=\\\"newMsg === ''\\\"\\r\\n          class=\\\"msg-btn\\\" (click)=\\\"sendMessage()\\\">\\r\\n          <ion-icon name=\\\"send\\\" slot=\\\"icon-only\\\"></ion-icon>\\r\\n        </ion-button>\\r\\n      </ion-col>\\r\\n    </ion-row>\\r\\n  </ion-toolbar>\\r\\n</ion-footer>\";","import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { ChatPage } from './chat.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: ChatPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class ChatPageRoutingModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { ChatPageRoutingModule } from './chat-routing.module';\r\n\r\nimport { ChatPage } from './chat.page';\r\nimport { FormatFileSizePipe } from './format-file-size.pipe';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    ChatPageRoutingModule\r\n  ],\r\n  declarations: [ChatPage,FormatFileSizePipe]\r\n})\r\nexport class ChatPageModule {}\r\n","export default \".message-input {\\n  width: 100%;\\n  border: 1px solid var(--ion-color-medium);\\n  border-radius: 6px;\\n  background: #eee3e3;\\n  resize: none;\\n  margin-top: 0px;\\n  --padding-start: 8px;\\n}\\n\\n.message {\\n  padding: 10px !important;\\n  border-radius: 10px !important;\\n  margin-bottom: 4px !important;\\n  white-space: pre-wrap;\\n}\\n\\n.my-message {\\n  background: var(--ion-color-tertiary);\\n  color: #fff;\\n}\\n\\n.other-message {\\n  background: var(--ion-color-secondary);\\n  color: #fff;\\n}\\n\\n.time {\\n  color: #dfdfdf;\\n  float: right;\\n  font-size: small;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9hcHAvcGFnZXMvY2hhdC9jaGF0LnBhZ2Uuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLFdBQUE7RUFDQSx5Q0FBQTtFQUNBLGtCQUFBO0VBQ0EsbUJBQUE7RUFDQSxZQUFBO0VBQ0EsZUFBQTtFQUNBLG9CQUFBO0FBQ0Y7O0FBRUE7RUFDRSx3QkFBQTtFQUNBLDhCQUFBO0VBQ0EsNkJBQUE7RUFDQSxxQkFBQTtBQUNGOztBQUVBO0VBQ0UscUNBQUE7RUFDQSxXQUFBO0FBQ0Y7O0FBRUE7RUFDRSxzQ0FBQTtFQUNBLFdBQUE7QUFDRjs7QUFFQTtFQUNFLGNBQUE7RUFDQSxZQUFBO0VBQ0EsZ0JBQUE7QUFDRiIsImZpbGUiOiJzcmMvYXBwL3BhZ2VzL2NoYXQvY2hhdC5wYWdlLnNjc3MiLCJzb3VyY2VzQ29udGVudCI6WyIubWVzc2FnZS1pbnB1dCB7XHJcbiAgd2lkdGg6IDEwMCU7XHJcbiAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0taW9uLWNvbG9yLW1lZGl1bSk7XHJcbiAgYm9yZGVyLXJhZGl1czogNnB4O1xyXG4gIGJhY2tncm91bmQ6ICNlZWUzZTM7XHJcbiAgcmVzaXplOiBub25lO1xyXG4gIG1hcmdpbi10b3A6IDBweDtcclxuICAtLXBhZGRpbmctc3RhcnQ6IDhweDtcclxufVxyXG5cclxuLm1lc3NhZ2Uge1xyXG4gIHBhZGRpbmc6IDEwcHggIWltcG9ydGFudDtcclxuICBib3JkZXItcmFkaXVzOiAxMHB4ICFpbXBvcnRhbnQ7XHJcbiAgbWFyZ2luLWJvdHRvbTogNHB4ICFpbXBvcnRhbnQ7XHJcbiAgd2hpdGUtc3BhY2U6IHByZS13cmFwO1xyXG59XHJcblxyXG4ubXktbWVzc2FnZSB7XHJcbiAgYmFja2dyb3VuZDogdmFyKC0taW9uLWNvbG9yLXRlcnRpYXJ5KTtcclxuICBjb2xvcjogI2ZmZjtcclxufVxyXG5cclxuLm90aGVyLW1lc3NhZ2Uge1xyXG4gIGJhY2tncm91bmQ6IHZhcigtLWlvbi1jb2xvci1zZWNvbmRhcnkpO1xyXG4gIGNvbG9yOiAjZmZmO1xyXG59XHJcblxyXG4udGltZSB7XHJcbiAgY29sb3I6ICNkZmRmZGY7XHJcbiAgZmxvYXQ6IHJpZ2h0O1xyXG4gIGZvbnQtc2l6ZTogc21hbGw7XHJcbn1cclxuIl19 */\";","import { Message } from './../../services/chat.service';\r\nimport { Component, OnInit, ViewChild } from '@angular/core';\r\nimport { ChatService } from '../../services/chat.service';\r\nimport { Router } from '@angular/router';\r\nimport { IonContent } from '@ionic/angular';\r\nimport { Observable } from 'rxjs';\r\nimport { finalize, tap } from 'rxjs/operators';\r\nimport { imgFile } from './../../services/chat.service';\r\n\r\n@Component({\r\n  selector: 'app-chat',\r\n  templateUrl: './chat.page.html',\r\n  styleUrls: ['./chat.page.scss'],\r\n})\r\nexport class ChatPage implements OnInit {\r\n  @ViewChild(IonContent) content: IonContent;\r\n \r\n  messages: Observable<Message[]>;\r\n  newMsg = '';\r\n  \r\n  constructor(private chatService: ChatService, private router: Router) \r\n  { }\r\n\r\n  ngOnInit() {\r\n    this.messages = this.chatService.getChatMessages();\r\n  }\r\n\r\n  sendMessage() {\r\n    this.chatService.addChatMessage(this.newMsg).then(() => {\r\n      this.newMsg = '';\r\n      this.content.scrollToBottom();\r\n    });\r\n  }\r\n\r\n  logout() {\r\n    this.chatService.logout().then(() => {\r\n      this.router.navigateByUrl('/', { replaceUrl: true });\r\n    });\r\n  }\r\n\r\n  uploadImage(event: FileList) {\r\n      \r\n    const file = event.item(0)\r\n\r\n    // Image validation\r\n    if (file.type.split('/')[0] !== 'image') { \r\n      console.log('File type is not supported!')\r\n      return;\r\n    }\r\n\r\n    this.chatService.isFileUploading = true;\r\n    this.chatService.isFileUploaded = false;\r\n\r\n    this.chatService.imgName = file.name;\r\n\r\n    // Storage path\r\n    const fileStoragePath = `filesStorage/${new Date().getTime()}_${file.name}`;\r\n\r\n    // Image reference\r\n    const imageRef = this.chatService.afStorage.ref(fileStoragePath);\r\n\r\n    // File upload task\r\n    this.chatService.fileUploadTask = this.chatService.afStorage.upload(fileStoragePath, file);\r\n\r\n    // Show uploading progress\r\n    this.chatService.percentageVal = this.chatService.fileUploadTask.percentageChanges();\r\n    this.chatService.trackSnapshot = this.chatService.fileUploadTask.snapshotChanges().pipe(\r\n      \r\n      finalize(() => {\r\n        // Retreive uploaded image storage path\r\n        this.chatService.UploadedImageURL = imageRef.getDownloadURL();\r\n        \r\n        this.chatService.UploadedImageURL.subscribe(resp=>{\r\n          this.storeFilesFirebase({\r\n            name: file.name,\r\n            filepath: resp,\r\n            size: this.chatService.imgSize\r\n          });\r\n          this.chatService.isFileUploading = false;\r\n          this.chatService.isFileUploaded = true;\r\n        },error=>{\r\n          console.log(error);\r\n        })\r\n      }),\r\n      tap(snap => {\r\n          this.chatService.imgSize = snap.totalBytes;\r\n      })\r\n    )\r\n}\r\n\r\n\r\nstoreFilesFirebase(image: imgFile) {\r\n    const fileId = this.chatService.afs.createId();\r\n    \r\n    this.chatService.filesCollection.doc(fileId).set(image).then(res => {\r\n      console.log(res);\r\n    }).catch(err => {\r\n      console.log(err);\r\n    });\r\n}\r\n\r\n}\r\n","import {Pipe, PipeTransform} from '@angular/core';\n\nconst FILE_SIZE_UNITS = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\nconst FILE_SIZE_UNITS_LONG = ['Bytes', 'Kilobytes', 'Megabytes', 'Gigabytes', 'Pettabytes', 'Exabytes', 'Zettabytes', 'Yottabytes'];\n\n@Pipe({\n  name: 'formatFileSize'\n})\n\nexport class FormatFileSizePipe implements PipeTransform {\n  transform(sizeInBytes: number, longForm: boolean): string {\n    const units = longForm\n      ? FILE_SIZE_UNITS_LONG\n      : FILE_SIZE_UNITS;\n    let power = Math.round(Math.log(sizeInBytes)/Math.log(1024));\n  \tpower = Math.min(power, units.length - 1);\n  \tconst size = sizeInBytes / Math.pow(1024, power); // size in new units\n  \tconst formattedSize = Math.round(size * 100) / 100; // keep up to 2 decimals\n  \tconst unit = units[power];\n  \treturn `${formattedSize} ${unit}`;\n  }\n}\n"],"sourceRoot":"webpack:///"}